<html>

<head>
  <title>
    Self Balancing Motorcycle
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=2.0">
  <script src="popper.min.js" type="text/javascript"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <script src="command_java.js" type="text/javascript"></script>
  
  <link href="prism.css" rel="stylesheet" />

  <link rel="stylesheet" href="mystyle.css">
</head>

<body data-prismjs-copy-timeout="500">
  <script src="prism.js"></script>
  <div class="background_img" style="min-height: 100%;">
  <div class="mt-4 p-5 bg-success text-white rounded myStyleTest">
  <h1 style="text-align:center;">Self Balancing Motorcycle</h1><br><br>
  <img src="src/Bot_img_modified.jpg" style="display:block;margin-left: auto;margin-right:auto; width:60%; height:auto"><br>
  <h2>Big Idea</h2>
  <p class="lead">The idea behind Self Balancing Motorcycle is to use the "Inertial Wheel or a Flywheel" on the back to balance the motorcycle. Observe that the problem behind "Balancing the motorcycle" can be analogous to the problem of "Balancing an Inverted Pendulum".  </p><br>
  <h2>State Space model</h2>
  <p class="lead">The image below shows the notable points</p><br>
  <img src="src/balancing-rotation-axis.png" style="display:block;margin-left: auto;margin-right:auto; width:60%; height:auto"><br><br>
  <ul class="lead" style="list-style-type: none" >
    <li> A - rotation axis of the revolute joint between pendulum rod and ground.</li>
    <li> B - center of the mass of the pendulum rod. Assuming the pendulum rod has a uniform density, B should be in the middle of A and D.</li>
    <li> C - rotation axis of the revolute joint between pendulum rod and inertial wheel.</li>
    <li> θ - angle of tilt of the motorcycle.</li>
    <li> ω - angular speed of the inertial wheel.</li>

  </ul>
  <p class="lead">The final acceleration equaton of the inertial wheel is </p>
  <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
    <mrow class="MJX-TeXAtom-ORD">
      <mover>
        <mi>&#x03B8;<!-- θ --></mi>
        <mo>&#x00A8;<!-- ¨ --></mo>
      </mover>
    </mrow>
    <mo>=</mo>
    <mfrac>
      <mrow>
        <msub>
          <mi>m</mi>
          <mi>r</mi>
        </msub>
        <mi>g</mi>
        <msub>
          <mi>l</mi>
          <mrow class="MJX-TeXAtom-ORD">
            <mi>A</mi>
            <mi>B</mi>
          </mrow>
        </msub>
        <mi>sin</mi>
        <mo>&#x2061;<!-- ⁡ --></mo>
        <mo stretchy="false">(</mo>
        <mi>&#x03B8;<!-- θ --></mi>
        <mo stretchy="false">)</mo>
        <mo>+</mo>
        <msub>
          <mi>m</mi>
          <mi>w</mi>
        </msub>
        <mi>g</mi>
        <msub>
          <mi>l</mi>
          <mrow class="MJX-TeXAtom-ORD">
            <mi>A</mi>
            <mi>C</mi>
          </mrow>
        </msub>
        <mi>sin</mi>
        <mo>&#x2061;<!-- ⁡ --></mo>
        <mo stretchy="false">(</mo>
        <mi>&#x03B8;<!-- θ --></mi>
        <mo stretchy="false">)</mo>
        <mo>&#x2212;<!-- − --></mo>
        <msub>
          <mi>&#x03C4;<!-- τ --></mi>
          <mi>m</mi>
        </msub>
      </mrow>
      <mrow>
        <mo stretchy="false">(</mo>
        <msub>
          <mi>m</mi>
          <mi>w</mi>
        </msub>
        <mo stretchy="false">(</mo>
        <mn>0.5</mn>
        <msup>
          <mi>R</mi>
          <mn>2</mn>
        </msup>
        <mo>+</mo>
        <msubsup>
          <mi>l</mi>
          <mrow class="MJX-TeXAtom-ORD">
            <mi>A</mi>
            <mi>C</mi>
          </mrow>
          <mn>2</mn>
        </msubsup>
        <mo stretchy="false">)</mo>
        <mo>+</mo>
        <mfrac>
          <mn>1</mn>
          <mn>12</mn>
        </mfrac>
        <msub>
          <mi>m</mi>
          <mi>r</mi>
        </msub>
        <mo stretchy="false">(</mo>
        <mn>3</mn>
        <msup>
          <mi>r</mi>
          <mn>2</mn>
        </msup>
        <mo>+</mo>
        <msubsup>
          <mi>l</mi>
          <mrow class="MJX-TeXAtom-ORD">
            <mi>A</mi>
            <mi>D</mi>
          </mrow>
          <mn>2</mn>
        </msubsup>
        <mo stretchy="false">)</mo>
        <mo>+</mo>
        <msub>
          <mi>m</mi>
          <mi>r</mi>
        </msub>
        <msubsup>
          <mi>l</mi>
          <mrow class="MJX-TeXAtom-ORD">
            <mi>A</mi>
            <mi>B</mi>
          </mrow>
          <mn>2</mn>
        </msubsup>
        <mo stretchy="false">)</mo>
      </mrow>
    </mfrac>
  </math>
  <p class="lead">Where </p>
  <ul class="lead" style="list-style-type: none" >
  <li><i>m<sub>r</sub></i>  - mass of the rod</li>
  <li><i>m<sub>w</sub></i>  - mass of the inertia wheel.</li>
  <li><i>l<sub>AB</sub></i> - the distance between A and B.</li>
  <li><i>l<sub>AC</sub></i> - the distance between A and C.</li>
  <li><i>l<sub>AD</sub></i> - the distance between A and D.</li>
  <li><i>R</i> - radius of the inertial wheel</li>
  <li><i>g</i> - acceleration due to gravity</li>
  </ul><br>
  <p class="lead"> The final state space equation is as follows </p><br>
  <math>
    <mrow>
      <mover>
        <mi>x</mi>
        <mo>&#x2D9;</mo>
      </mover>
    </mrow>
    <mo stretchy="false">(</mo>
    <mi>t</mi>
    <mo stretchy="false">)</mo>
    <mo>=</mo>
    <mrow data-mjx-texclass="INNER">
      <mo data-mjx-texclass="OPEN">(</mo>
      <mtable rowspacing="4pt" columnspacing="1em">
        <mtr>
          <mtd>
            <mrow>
              <mover>
                <mi>&#x3B8;</mi>
                <mo>&#x2D9;</mo>
              </mover>
            </mrow>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <mrow>
              <mover>
                <mi>&#x3B8;</mi>
                <mo>&#xA8;</mo>
              </mover>
            </mrow>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <mrow>
              <mover>
                <mi>&#x3C9;</mi>
                <mo>&#x2D9;</mo>
              </mover>
            </mrow>
          </mtd>
        </mtr>
      </mtable>
      <mo data-mjx-texclass="CLOSE">)</mo>
    </mrow>
    <mo>=</mo>
    <mrow data-mjx-texclass="INNER">
      <mo data-mjx-texclass="OPEN">(</mo>
      <mtable rowspacing="4pt" columnspacing="1em">
        <mtr>
          <mtd>
            <mrow>
              <mover>
                <mi>&#x3B8;</mi>
                <mo>&#x2D9;</mo>
              </mover>
            </mrow>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <mfrac>
              <mrow>
                <mi>g</mi>
                <mi>sin</mi>
                <mo data-mjx-texclass="NONE">&#x2061;</mo>
                <mo stretchy="false">(</mo>
                <mi>&#x3B8;</mi>
                <mo stretchy="false">)</mo>
                <mo stretchy="false">(</mo>
                <msub>
                  <mi>m</mi>
                  <mi>r</mi>
                </msub>
                <msub>
                  <mi>l</mi>
                  <mrow>
                    <mi>A</mi>
                    <mi>B</mi>
                  </mrow>
                </msub>
                <mo>+</mo>
                <msub>
                  <mi>m</mi>
                  <mi>w</mi>
                </msub>
                <msub>
                  <mi>l</mi>
                  <mrow>
                    <mi>A</mi>
                    <mi>C</mi>
                  </mrow>
                </msub>
                <mo stretchy="false">)</mo>
                <mo>&#x2212;</mo>
                <msub>
                  <mi>&#x3C4;</mi>
                  <mi>m</mi>
                </msub>
              </mrow>
              <mrow>
                <msub>
                  <mi>m</mi>
                  <mi>w</mi>
                </msub>
                <mo stretchy="false">(</mo>
                <mn>0.5</mn>
                <msup>
                  <mi>R</mi>
                  <mn>2</mn>
                </msup>
                <mo>+</mo>
                <msubsup>
                  <mi>l</mi>
                  <mrow>
                    <mi>A</mi>
                    <mi>C</mi>
                  </mrow>
                  <mn>2</mn>
                </msubsup>
                <mo stretchy="false">)</mo>
                <mo>+</mo>
                <mfrac>
                  <mn>1</mn>
                  <mn>12</mn>
                </mfrac>
                <msub>
                  <mi>m</mi>
                  <mi>r</mi>
                </msub>
                <mo stretchy="false">(</mo>
                <mn>3</mn>
                <msup>
                  <mi>r</mi>
                  <mn>2</mn>
                </msup>
                <mo>+</mo>
                <msubsup>
                  <mi>l</mi>
                  <mrow>
                    <mi>A</mi>
                    <mi>D</mi>
                  </mrow>
                  <mn>2</mn>
                </msubsup>
                <mo stretchy="false">)</mo>
                <mo>+</mo>
                <msub>
                  <mi>m</mi>
                  <mi>r</mi>
                </msub>
                <msubsup>
                  <mi>l</mi>
                  <mrow>
                    <mi>A</mi>
                    <mi>B</mi>
                  </mrow>
                  <mn>2</mn>
                </msubsup>
              </mrow>
            </mfrac>
          </mtd>
        </mtr>
        <mtr>
          <mtd>
            <msub>
              <mi>&#x3C4;</mi>
              <mi>m</mi>
            </msub>
            <mrow>
              <mo>/</mo>
            </mrow>
            <msubsup>
              <mi>I</mi>
              <mi>w</mi>
              <mi>C</mi>
            </msubsup>
            <mo>&#x2212;</mo>
            <mrow>
              <mover>
                <mi>&#x3B8;</mi>
                <mo>&#x2D9;</mo>
              </mover>
            </mrow>
          </mtd>
        </mtr>
      </mtable>
      <mo data-mjx-texclass="CLOSE">)</mo>
    </mrow>
  </math>
<br><br><br>
<h2>Simulink Program</h2><br>
<p class="lead">The overall simulink program is a closed loop control system, sensor data from the motorcycle sub-block is sent to the controller sub-block, the raw sensor data is preprocessed, PD controller and state flow logic is programmed in the controller sub-block and control commands to the motorcycle sub-block to control the motors. </p><br>
<p class="lead">The image below shows the overall structure of the simulink program.</p>

<img src="src/Overall_circuit.png" style="width:70%;height:auto;display:block;margin-left: auto;margin-right:auto;"><br><br> 
<h2>Sensor Preprocessing</h2>
<ul class="lead">
  <li>The sensor data must be preprocessed before using it in the controller.</li>
  <li>The "Arduino nano 33 IOT" board used in the motorcycle consists of an inbuild BNO055 9-axis absolute orientation sensor from Bosch. </li>
  <li>A prebuild simulink block is used to read the sensor data and the status gives the calibration vector which is used to determine the calibration status of the sensor.</li>
  <li>The angular velocity (thetaDot) and Euler angle (theta) are filtered to select only the angular velocity and angle for "Roll" of the motorcycle. The "Roll" angle and rate is used to balance the motorcycle. </li>
  <li>Finally the angle and rates are converted to radians. </li>
  <li>The encoder in the Inertial wheel motor is used to determine the speed of the Inertial wheel. The encoder is 48 PPR (Pulse Per Revolution),hence multiplied by 1/48 to convert to rotations.  </li>
  <li>The values are converted to radians and filtered. </li>
  <br>
  <img src="src/sensor_preprocessing.png" style="width:80%;height:auto;display:block;margin-right: auto;margin-left: auto;"><br>
  <img src="">
</ul><br>
<h2>State Flow Chart</h2>
<p class="lead">The State flow chart shown below defines the logic for the motorcycle.</p>
<img src="src/state_flow_chart.png" style="width:80%;height:auto;display:block;margin-right: auto;margin-left: auto;"><br>
<h2>Controller</h2>
<p class="lead">The closed loop control system is a simple PD controller as shown below</p>
<img src="src/Self_Balancing_Robot_Controller.jpg" style="display:block;margin-left: auto;margin-right:auto; width:80%; height:auto"><br>
<ul class="lead">
  <li>K<sub>p</sub> - proportional constant that controls theta.</li>
  <li>K<sub>d</sub></i>  - derivative constant that controls thetaDot</li>
  <li>K<sub>pw</sub></i> - proportional constant to control inertial wheel's speed</li>
</ul><br>

<ul class="lead">
  <li>The P and D values are tuned to balance the motorcycle.</li>
</ul>
<br><br>
<h2>Working Video</h2>
<p class="lead">The overall simulink block diagram and working of the motorcycle is shown in the video below </p><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/T9QwjRZ5eqI" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen style="display:block;margin-left: auto;margin-right: auto;"></iframe>


</div>
    
  </div>
  </div>
</body>
</html>